{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 244, "column": 0}, "map": {"version":3,"sources":["file:///Users/peterbassett/Documents/Projects/mcma-kitchen-volunteers/src/app/api/confirm-to-event/route.js"],"sourcesContent":["import { google } from 'googleapis';\n\nexport async function POST(req) {\n  const { name, phone, eventName, eventDate } = await req.json();\n\n  if (!name || !phone || !eventName || !eventDate) {\n    return Response.json({ error: 'Missing required fields' }, { status: 400 });\n  }\n\n  const auth = new google.auth.GoogleAuth({\n    credentials: {\n      client_email: process.env.GOOGLE_CLIENT_EMAIL,\n      private_key: process.env.GOOGLE_PRIVATE_KEY.replace(/\\\\n/g, '\\n'),\n    },\n    scopes: ['https://www.googleapis.com/auth/spreadsheets'],\n  });\n\n  const sheets = google.sheets({ version: 'v4', auth });\n  const spreadsheetId = process.env.GOOGLE_SHEET_ID;\n  const range = '2025 Schedule of Events!A1:Q1000';\n\n  const result = await sheets.spreadsheets.values.get({ spreadsheetId, range });\n  const rows = result.data.values;\n  const data = rows.slice(1); // skip header\n\n  const matchIndex = data.findIndex(row =>\n    row[0]?.trim() === eventDate.trim() &&\n    row[1]?.trim().toLowerCase() === eventName.trim().toLowerCase()\n  );\n\n  if (matchIndex === -1) {\n    return Response.json({ message: 'Event not found', notFound: true }, { status: 404 });\n  }\n\n  const row = data[matchIndex];\n  const volunteerCols = [5, 7, 9, 11, 13, 15]; // F, H, J, L, N, P\n\n  console.log('Matched row index:', matchIndex);\n  console.log('Volunteer name cells:', volunteerCols.map(i => `[${i}] \"${row[i]}\"`).join(', '));\n\n  let emptyCol = null;\n  for (const col of volunteerCols) {\n    const val = row[col]?.trim();\n    if (!val) {\n      emptyCol = col;\n      break;\n    }\n  }\n\n  if (emptyCol === null) {\n    return Response.json({ message: 'Event is full', full: true });\n  }\n\n  const sheetRow = matchIndex + 2;\n  const nameCol = String.fromCharCode(65 + emptyCol);\n  const phoneCol = String.fromCharCode(65 + emptyCol + 1);\n\n  console.log(`Confirming ${name} to \"${eventName}\" on ${eventDate} at row ${sheetRow}, cols ${nameCol}/${phoneCol}`);\n\n  try {\n    await sheets.spreadsheets.values.batchUpdate({\n      spreadsheetId,\n      requestBody: {\n        valueInputOption: 'USER_ENTERED',\n        data: [\n          {\n            range: `2025 Schedule of Events!${nameCol}${sheetRow}`,\n            values: [[name]],\n          },\n          {\n            range: `2025 Schedule of Events!${phoneCol}${sheetRow}`,\n            values: [[phone]],\n          },\n        ],\n      },\n    });\n\n    return Response.json({ message: 'Confirmed to event', success: true });\n  } catch (error) {\n    console.error('Sheet write error:', error);\n    return Response.json({ error: 'Sheet write failed' }, { status: 500 });\n  }\n}"],"names":[],"mappings":"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","debugId":null}}]
}